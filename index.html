<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>Проверка доступа</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Важно для потока индексации -->
  <meta name="robots" content="noindex, follow">
  <link rel="canonical" href="https://v2raytun.de/home.html">
  <meta name="yandex-verification" content="c9adacc91d7194c6">
  <meta name="color-scheme" content="dark">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon.png">
  <!-- Чуть ускорим показ образца -->
  <link rel="preload" as="image" href="assets/flags/germany.png" imagesrcset="assets/flags/germany.png 1x">
  <style>
    :root{--bg:#0d1117;--fg:#fff;--ring:#fff;--error:#ff3b3b;--radius:8px;--radius-sm:6px;--t:.2s}
    *{box-sizing:border-box}
    body{
      margin:0;background:var(--bg);color:var(--fg);
      font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      min-height:100dvh;display:flex;align-items:center;justify-content:center;text-align:center
    }
    .wrap{max-width:820px;padding:16px}
    .title{margin:0 0 18px;font-weight:700;line-height:1.3;font-size:22px}
    #flagTarget{margin:12px 0 18px}
    .sample{border:2px solid var(--ring);border-radius:var(--radius);transform:rotate(.5turn)}
    #flagOptions{display:flex;gap:14px;flex-wrap:wrap;justify-content:center}
    /* кнопка-флаг */
    .option{
      width:70px;height:48px;border-radius:var(--radius-sm);
      border:2px solid transparent;cursor:pointer;transition:transform var(--t),border-color var(--t)
    }
    .option:hover,.option:focus-visible{transform:scale(1.05);outline:none;border-color:#6ea8fe}
    @keyframes blink{0%,100%{border-color:transparent}10%,90%{border-color:var(--error)}}
    .wrong{animation:blink .6s linear 1}
    .fallback{margin-top:14px}
    .fallback a{color:#fff;text-decoration:underline;font-weight:600}
    noscript{display:block;margin-top:10px}
  </style>
</head>
<body>
  <div class="wrap">
    <h2 class="title">Нужно подтвердить, что вы человек.<br>Выберите картинку, совпадающую с образцом флага:</h2>

    <!-- Видимая ссылка для робота и пользователей без JS -->
    <p class="fallback">Если проверка недоступна, откройте основную страницу: <a href="home.html">home.html</a></p>

    <div id="flagTarget" aria-live="polite"></div>
    <div id="flagOptions" role="group" aria-label="Варианты флагов"></div>

    <noscript>Для продолжения включите JavaScript или перейдите на <a href="home.html">home.html</a>.</noscript>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const FLAGS = [
        { name: "canada",      src: "assets/flags/canada.png" },
        { name: "uk",          src: "assets/flags/uk.png" },
        { name: "moldova",     src: "assets/flags/moldova.png" },
        { name: "south_korea", src: "assets/flags/south_korea.png" },
        { name: "japan",       src: "assets/flags/japan.png" },
        { name: "germany",     src: "assets/flags/germany.png" } // будет прелоад
      ];

      const $target  = document.getElementById("flagTarget");
      const $options = document.getElementById("flagOptions");

      const rint = (m)=> (crypto?.getRandomValues ? (new Uint32Array(1), crypto.getRandomValues(arguments[0] = new Uint32Array(1)), arguments[0][0] % m) : Math.floor(Math.random()*m));
      const shuffle = (a)=>{const x=a.slice();for(let i=x.length-1;i>0;i--){const j=rint(i+1);[x[i],x[j]]=[x[j],x[i]]}return x};

      const correct = FLAGS[rint(FLAGS.length)];

      const sample = new Image();
      sample.className = "sample";
      sample.src = correct.src;
      sample.alt = "Образец флага";
      sample.width = 110; sample.height = 70;
      sample.decoding = "async"; sample.loading = "eager";
      $target.appendChild(sample);

      for (const flag of shuffle(FLAGS)) {
        const img = new Image();
        img.className = "option";
        img.src = flag.src;
        img.alt = "Вариант флага";
        img.decoding = "async";
        img.loading = "lazy";
        img.tabIndex = 0;              // доступность с клавиатуры
        img.setAttribute("role","button");
        img.setAttribute("aria-label","Выбрать флаг");

        const choose = () => {
          if (flag.name === correct.name) {
            location.href = "home.html";
          } else {
            img.classList.remove("wrong"); void img.offsetWidth; img.classList.add("wrong");
          }
        };
        img.addEventListener("click", choose);
        img.addEventListener("keydown", (e) => { if (e.key === "Enter" || e.key === " ") { e.preventDefault(); choose(); } });

        $options.appendChild(img);
      }
    });
  </script>

  <!-- Yandex.Metrika -->
  <script>
    (function(m,e,t,r,i,k,a){
      m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
      m[i].l=1*new Date();
      for (var j=0;j<document.scripts.length;j++){ if (document.scripts[j].src===r){ return; } }
      k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window,document,'script','https://mc.yandex.ru/metrika/tag.js?id=105570211','ym');
    ym(105570211,'init',{ssr:true,webvisor:true,clickmap:true,ecommerce:"dataLayer",accurateTrackBounce:true,trackLinks:true});
  </script>
  <noscript><div><img src="https://mc.yandex.ru/watch/105570211" style="position:absolute;left:-9999px" alt=""></div></noscript>
  <!-- /Yandex.Metrika -->
</body>
</html>
